{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/ahmed/Documents/mern-expense-app/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/ahmed/Documents/mern-expense-app/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{AUTH_FAILED,AUTH_SUCCESS,AUTH_ATTEMPTING,USER_LOGOUT,PROFILE_FETCHED}from'./types';import{apiLogin,fetchProfile}from'../api/user';import setAuthHeader from'../api/setAuthHeader';var TOKEN_NAME='expense_app_token';export var signIn=function signIn(request_data){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var _yield$apiLogin,data,_data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatch({type:AUTH_ATTEMPTING});_context.prev=1;_context.next=4;return apiLogin(request_data);case 4:_yield$apiLogin=_context.sent;data=_yield$apiLogin.data;setAuthHeader(data.token);dispatch(getProfile());dispatch(success(data.token));_context.next=15;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](1);_data=_context.t0.response.data;dispatch(error(_data.error));case 15:case\"end\":return _context.stop();}}},_callee,null,[[1,11]]);}));return function(_x){return _ref.apply(this,arguments);};}();};export var onLoadingSignIn=function onLoadingSignIn(){return function(dispatch){try{var token=localStorage.getItem(TOKEN_NAME);if(token===null||token==='undefined'){return dispatch(error('You need to login'));}setAuthHeader(token);dispatch(getProfile());dispatch(success(token));}catch(e){console.log(e);}};};export var getProfile=function getProfile(){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch){var _yield$fetchProfile,user;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return fetchProfile();case 3:_yield$fetchProfile=_context2.sent;user=_yield$fetchProfile.data.user;dispatch({type:PROFILE_FETCHED,payload:user});_context2.next=11;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);console.error(_context2.t0);case 11:case\"end\":return _context2.stop();}}},_callee2,null,[[0,8]]);}));return function(_x2){return _ref2.apply(this,arguments);};}();};export var logOut=function logOut(){localStorage.clear();return{type:USER_LOGOUT};};var success=function success(token){localStorage.setItem(TOKEN_NAME,token);return{type:AUTH_SUCCESS};};var error=function error(_error){return{type:AUTH_FAILED,payload:_error};};","map":{"version":3,"sources":["C:/Users/ahmed/Documents/mern-expense-app/client/src/actions/auth_actions.js"],"names":["AUTH_FAILED","AUTH_SUCCESS","AUTH_ATTEMPTING","USER_LOGOUT","PROFILE_FETCHED","apiLogin","fetchProfile","setAuthHeader","TOKEN_NAME","signIn","request_data","dispatch","type","data","token","getProfile","success","response","error","onLoadingSignIn","localStorage","getItem","e","console","log","user","payload","logOut","clear","setItem"],"mappings":"2UAAA,OAASA,WAAT,CAAsBC,YAAtB,CAAoCC,eAApC,CAAqDC,WAArD,CAAkEC,eAAlE,KAAyF,SAAzF,CACA,OAASC,QAAT,CAAmBC,YAAnB,KAAuC,aAAvC,CACA,MAAOC,CAAAA,aAAP,KAA0B,sBAA1B,CAEA,GAAMC,CAAAA,UAAU,CAAG,mBAAnB,CACA,MAAO,IAAMC,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,CAAAC,YAAY,CAAI,CAClC,+FAAO,iBAAMC,QAAN,iJACHA,QAAQ,CAAC,CAAEC,IAAI,CAAEV,eAAR,CAAD,CAAR,CADG,sCAGwBG,CAAAA,QAAQ,CAACK,YAAD,CAHhC,sCAGSG,IAHT,iBAGSA,IAHT,CAICN,aAAa,CAACM,IAAI,CAACC,KAAN,CAAb,CACAH,QAAQ,CAACI,UAAU,EAAX,CAAR,CACAJ,QAAQ,CAACK,OAAO,CAACH,IAAI,CAACC,KAAN,CAAR,CAAR,CAND,iFAQqBD,KARrB,aAQSI,QART,CAQqBJ,IARrB,CASCF,QAAQ,CAACO,KAAK,CAACL,KAAI,CAACK,KAAN,CAAN,CAAR,CATD,qEAAP,+DAYH,CAbM,CAgBP,MAAO,IAAMC,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,EAAM,CACjC,MAAO,UAAAR,QAAQ,CAAI,CACf,GAAI,CACA,GAAMG,CAAAA,KAAK,CAAGM,YAAY,CAACC,OAAb,CAAqBb,UAArB,CAAd,CACA,GAAIM,KAAK,GAAK,IAAV,EAAkBA,KAAK,GAAK,WAAhC,CAA6C,CACzC,MAAOH,CAAAA,QAAQ,CAACO,KAAK,CAAC,mBAAD,CAAN,CAAf,CACH,CACDX,aAAa,CAACO,KAAD,CAAb,CACAH,QAAQ,CAACI,UAAU,EAAX,CAAR,CACAJ,QAAQ,CAACK,OAAO,CAACF,KAAD,CAAR,CAAR,CACH,CAAC,MAAOQ,CAAP,CAAU,CACRC,OAAO,CAACC,GAAR,CAAYF,CAAZ,EACH,CACJ,CAZD,CAaH,CAdM,CAiBP,MAAO,IAAMP,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,EAAM,CAC5B,gGAAO,kBAAMJ,QAAN,2LAEkCL,CAAAA,YAAY,EAF9C,2CAEiBmB,IAFjB,qBAESZ,IAFT,CAEiBY,IAFjB,CAGCd,QAAQ,CAAC,CAACC,IAAI,CAACR,eAAN,CAAuBsB,OAAO,CAAED,IAAhC,CAAD,CAAR,CAHD,mFAKCF,OAAO,CAACL,KAAR,eALD,sEAAP,iEAQH,CATM,CAYP,MAAO,IAAMS,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,EAAM,CACxBP,YAAY,CAACQ,KAAb,GACA,MAAQ,CAAEhB,IAAI,CAAET,WAAR,CAAR,CACH,CAHM,CAOP,GAAMa,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,CAACF,KAAD,CAAW,CACvBM,YAAY,CAACS,OAAb,CAAqBrB,UAArB,CAAiCM,KAAjC,EACA,MAAO,CAAEF,IAAI,CAAEX,YAAR,CAAP,CACH,CAHD,CAIA,GAAMiB,CAAAA,KAAK,CAAG,eAACA,MAAD,CAAW,CACrB,MAAO,CAAEN,IAAI,CAAEZ,WAAR,CAAqB0B,OAAO,CAAER,MAA9B,CAAP,CACH,CAFD","sourcesContent":["import { AUTH_FAILED, AUTH_SUCCESS, AUTH_ATTEMPTING, USER_LOGOUT, PROFILE_FETCHED } from './types'\r\nimport { apiLogin, fetchProfile } from '../api/user';\r\nimport setAuthHeader from '../api/setAuthHeader';\r\n\r\nconst TOKEN_NAME = 'expense_app_token';\r\nexport const signIn = request_data => {\r\n    return async dispatch => {\r\n        dispatch({ type: AUTH_ATTEMPTING })\r\n        try {\r\n            const { data } = await apiLogin(request_data)\r\n            setAuthHeader(data.token)\r\n            dispatch(getProfile());\r\n            dispatch(success(data.token))\r\n        } catch (e) {\r\n            const { response: { data } } = e\r\n            dispatch(error(data.error))\r\n        }\r\n    };\r\n};\r\n\r\n\r\nexport const onLoadingSignIn = () => {\r\n    return dispatch => {\r\n        try {\r\n            const token = localStorage.getItem(TOKEN_NAME);\r\n            if (token === null || token === 'undefined') {\r\n                return dispatch(error('You need to login'));\r\n            }\r\n            setAuthHeader(token)\r\n            dispatch(getProfile())\r\n            dispatch(success(token))\r\n        } catch (e) {\r\n            console.log(e)\r\n        }\r\n    }\r\n}\r\n\r\n\r\nexport const getProfile = () => {\r\n    return async dispatch => {\r\n        try {\r\n            const { data: { user } } = await fetchProfile()\r\n            dispatch({type:PROFILE_FETCHED, payload: user})\r\n        } catch (e) {\r\n            console.error(e)\r\n        }\r\n    }\r\n}\r\n\r\n\r\nexport const logOut = () => {\r\n    localStorage.clear()\r\n    return ({ type: USER_LOGOUT })\r\n}\r\n\r\n\r\n\r\nconst success = (token) => {\r\n    localStorage.setItem(TOKEN_NAME, token)\r\n    return { type: AUTH_SUCCESS }\r\n};\r\nconst error = (error) => {\r\n    return { type: AUTH_FAILED, payload: error }\r\n};"]},"metadata":{},"sourceType":"module"}